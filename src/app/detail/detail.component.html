<div class="holder">
  <mat-card  class="mat-elevation-z4">
    <mat-card-title-group>
      <mat-card-title>
        {{fountain.properties['name_'+(lang|async)].value}}
        <span *ngIf="!fountain.properties.name.value">
          {{'other.unnamed_fountain' | translate}}
          <call-to-action pName="name"></call-to-action>
        </span>
      </mat-card-title>
      <mat-card-subtitle>
        <span class="badge potable icon-small"
              [ngClass]="fountain.properties.potable.value===null?'other':fountain.properties.potable.value"
              title="{{'property.potable'| translate}}"><mat-icon svgIcon="cup"></mat-icon></span>
        <span class="badge year"
              *ngIf="fountain.properties.construction_date.value"
              title="{{'property.construction_date'| translate}}">
          <span >{{fountain.properties.construction_date.value}}</span>
        </span>
        <span class="badge"
              *ngIf="fountain.properties.water_type.value"
              title="{{'property.water_type'| translate}}">
          {{fountain.properties.water_type.value | translate}}</span>

        <span class="badge icon-small" *ngIf="fountain.properties.access_wheelchair.value!==null"
              [ngClass]="fountain.properties.access_wheelchair.value"
              title="{{'property.access_wheelchair'| translate}}"><mat-icon>accessible</mat-icon></span>

        <span class="badge icon-small" *ngIf="fountain.properties.access_pet.value!==null"
              [ngClass]="fountain.properties.access_pet.value"
              title="{{'property.access_pet'| translate}}"><mat-icon>pets</mat-icon></span>

        <span class="badge icon-small"  [ngClass]="fountain.properties.access_bottle.value"
              *ngIf="fountain.properties.access_bottle.value!==null"
              title="{{'property.access_bottle'| translate}}"><mat-icon svgIcon="bottle"></mat-icon></span>
      </mat-card-subtitle>
    </mat-card-title-group>


    <gallery
      gallerize loop="false"
      [items]="images"
      [itemTemplate]="itemTemplate"
      imageSize="cover"
      [counter]="false"
      [thumbPosition]="mobileQuery?'bottom':'left'"
      [thumb]="images.length-1">
    </gallery>
    <ng-template #itemTemplate
                 let-index="index"
                 let-type="type"
                 let-data="data"
                 let-currIndex="currIndex">
  <span *ngIf="type === 'image' && index === currIndex" [@slideAnimation] class="caption" [innerHTML]="data?.title">
  </span>
    </ng-template>
    <div style="width:100%; height: 20px; text-align: right">
      <button id="add-image-button" mat-mini-fab color="accent" title="{{'action.cta_image' | translate}}">
        <mat-icon>add</mat-icon>
      </button>
    </div>

    <mat-card-content>
      <div *ngIf="(fountain.properties['description_short_'+(lang|async)].value !== null) && (fountain.properties['wikipedia_'+(lang|async)+'_summary'].value === null)">
        <p>{{fountain.properties['description_short_'+(lang|async)].value}}</p>
      </div>
      <div *ngIf="fountain.properties['wikipedia_'+(lang|async)+'_summary'].value !== null">
        <p class="wikipedia-summary">{{fountain.properties['wikipedia_'+(lang|async)+'_summary'].value | truncate : 300}}
          <a class="quicklink" mat-stroked-button target="_blank" href="{{fountain.properties['wikipedia_'+(lang|async)+'_url'].value}}"><mat-icon svgIcon="wikipedia"></mat-icon> {{'action.more'|translate}}...</a></p>
      </div>
        <p *ngIf="fountain.properties.directions.value !== null">
          <span style="font-weight: bold" translate>property.directions</span>: {{fountain.properties.directions.value}}
        </p>
      <p>
        <a mat-stroked-button
           *ngFor="let pano of fountain.properties.pano_url.value"
           [href]="pano.url"
           [title]="'quicklink.pano_url' | translate"
           target="_blank"><mat-icon svgIcon="panorama"></mat-icon>&nbsp;{{pano.source_name}}</a>
      </p>

      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>{{('detail.show_all_properties' | translate)+' ('+propertyCount+')'}}</mat-panel-title>
        </mat-expansion-panel-header>
        <mat-checkbox (change)="showindefinite = !showindefinite;filterTable();"
                      [checked]="!showindefinite" >
          {{('detail.only_with_values' | translate)+' ('+filteredPropertyCount+')'}}
        </mat-checkbox>
        <table mat-table [dataSource]="tableProperties">
          <ng-container matColumnDef="propName">
            <td mat-cell *matCellDef="let p"> {{'property.'+p.name | translate}} </td>
          </ng-container>
          <ng-container matColumnDef="propVal">
            <td mat-cell *matCellDef="let p"> <f-property [property]="p"></f-property> </td>
          </ng-container>
          <tr mat-row *matRowDef="let row; columns: ['propName', 'propVal'];"></tr>
        </table>
        <p>
          <span>{{'property.merge_notes' | translate}}: {{fountain.properties.conflation_info.merge_notes}}</span><br/>
          <span>{{'property.merge_distance' | translate}}: {{fountain.properties.conflation_info.merge_distance | number:'1.2'}} m</span><br/>
        </p>

        <p translate>detail.how_to_refresh_message</p>
      </mat-expansion-panel>
    </mat-card-content>
    <mat-card-actions>
      <a mat-mini-fab color="accent"
         [href]="'https://www.google.ch/maps/dir//'+fountain.geometry.coordinates[1]+','+fountain.geometry.coordinates[0]"
         target="_blank"
         [title]="'action.navigate' | translate">
        <mat-icon>train</mat-icon>
      </a>
      <button mat-mini-fab color="accent" (click)="navigateToFountain()" [title]="'action.navigate' | translate">
        <mat-icon>directions_walk</mat-icon>
      </button>
      <button mat-mini-fab color="primary" (click)="forceRefresh()"  [title]="'action.refresh' | translate">
        <mat-icon>refresh</mat-icon>
      </button>
      <button mat-mini-fab color="primary"
              [matMenuTriggerFor]="linkMenu"
              title="Linked data">
        <mat-icon>open_in_new</mat-icon>
      </button>
      <mat-menu #linkMenu="matMenu">
        <a mat-menu-item
           *ngFor="let quickLink of quickLinks"
           [href]="quickLink.value"
           target="_blank"><mat-icon>open_in_new</mat-icon>{{'quicklink.'+quickLink.name | translate}}</a>
      </mat-menu>
      <button mat-raised-button color="basic" (click)="returnToMap()">
        <mat-icon>close</mat-icon><span translate>action.close</span>
      </button>
    </mat-card-actions>
  </mat-card>

</div>

